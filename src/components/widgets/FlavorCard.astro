---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

// components/widgets/FlavorCard.astro
interface Props {
  title: string;
  description?: string;
  image: string | ImageMetadata;
  href: string;
  buttonText?: string;
  class?: string;
}

const { title, description, image, href, buttonText = "Ver productos", class: extraClass = "" } = Astro.props;

---

<a
  href={href}
  data-glass-tilt
  class={`glass-tilt-card group h-72 w-full relative overflow-hidden rounded-xl shadow-lg ${extraClass}`}
>
  {
    typeof image === 'string' ? (
      <img
        src={image}
        alt={title}
        class="absolute inset-0 object-cover w-full h-full transition-transform duration-500 group-hover:scale-105"
      />
    ) : (
      <Image
        src={image}
        alt={title}
        class="absolute inset-0 object-cover w-full h-full transition-transform duration-500 group-hover:scale-105"
      />
    )
  }
</a>
  <div class="absolute inset-0 bg-black/5 group-hover:bg-black/30 transition-colors duration-300"></div>
  <div
    class="relative z-10 flex flex-col justify-center items-center h-full text-center text-white px-4"
    style="text-shadow: 1px 1px 5px rgba(0,0,0,0.8);"
  >
    <h3 class="text-xl font-bold mb-2">{title}</h3>
    {description && <p class="text-sm mb-4">{description}</p>}
    <span
      class="inline-block px-4 py-2 border border-white rounded-full text-sm font-semibold transition-all duration-300 hover:bg-red-600 hover:text-white"
      style="text-shadow: 1px 1px 4px rgba(0,0,0,0.8);"
      onmouseover="this.style.textShadow='none';"
      onmouseout="this.style.textShadow='1px 1px 4px rgba(0,0,0,0.8)';"
    >
      {buttonText}
    </span>
  </div>
</a>

<script is:inline>
  (() => {
    if (window.__glassTiltInit) return;
    window.__glassTiltInit = true;

    const activeClass = 'active';
    const maxTilt = 12;

    const setTilt = (element, event) => {
      const rect = element.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = ((y - centerY) / centerY) * -maxTilt;
      const rotateY = ((x - centerX) / centerX) * maxTilt;

      element.style.setProperty('--tilt-x', `${rotateX.toFixed(2)}deg`);
      element.style.setProperty('--tilt-y', `${rotateY.toFixed(2)}deg`);
      element.style.setProperty('--glow-x', `${x.toFixed(0)}px`);
      element.style.setProperty('--glow-y', `${y.toFixed(0)}px`);
    };

    const resetTilt = (element) => {
      element.style.setProperty('--tilt-x', '0deg');
      element.style.setProperty('--tilt-y', '0deg');
      element.style.setProperty('--glow-x', '50%');
      element.style.setProperty('--glow-y', '50%');
    };

    const handlePointerMove = (event) => {
      const target = event.target.closest('[data-glass-tilt]');
      if (!target) return;
      target.dataset.glass = activeClass;
      setTilt(target, event);
    };

    const handlePointerLeave = (event) => {
      const target = event.target.closest('[data-glass-tilt]');
      if (!target) return;
      target.dataset.glass = '';
      resetTilt(target);
    };

    document.addEventListener('pointermove', handlePointerMove);
    document.addEventListener('pointerleave', handlePointerLeave, true);
  })();
</script>
