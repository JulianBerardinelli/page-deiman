---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';

const {
  title,
  subtitle,
  tagline,
  tabs = [],
  id,
  isDark = false,
  classes = {},
} = Astro.props;

const tabsId = id ?? 'format-tabs';
const hasMultipleTabs = tabs.length > 1;
---

<WidgetWrapper id={tabsId} isDark={isDark} containerClass={`max-w-5xl ${classes?.container ?? ''}`}>
  <Headline
    title={title}
    subtitle={subtitle}
    tagline={tagline}
    classes={{
      container: 'text-center',
      title: 'text-3xl lg:text-4xl',
      ...((classes?.headline as object) ?? {}),
    }}
  />

  {tabs.length > 0 && (
    <div class="mt-8" data-tabs-id={tabsId}>
      {hasMultipleTabs && (
        <div class="flex flex-wrap justify-center gap-3">
          {tabs.map((tab, index) => (
            <button
              type="button"
              class:list={[
                'rounded-full border border-primary/20 px-6 py-2 text-sm font-semibold text-primary transition',
                'hover:border-primary hover:text-primary',
                { 'bg-primary text-white shadow-sm': index === 0 },
              ]}
              data-tab-target={`${tabsId}-panel-${index}`}
            >
              {tab.label}
            </button>
          ))}
        </div>
      )}

      <div class="mt-6 space-y-4">
        {tabs.map((tab, index) => (
          <div
            class:list={[
              'rounded-2xl border border-gray-100 bg-white p-6 shadow-sm dark:border-gray-700/60 dark:bg-slate-900',
              { hidden: hasMultipleTabs && index !== 0 },
            ]}
            data-tab-panel={`${tabsId}-panel-${index}`}
          >
            <div class="flex flex-col gap-4">
              <div>
                <p class="text-sm font-semibold uppercase tracking-wide text-primary">{tab.label}</p>
                <h3 class="mt-2 text-xl font-semibold text-heading dark:text-white">{tab.title}</h3>
                <p class="mt-2 text-muted dark:text-slate-300">{tab.description}</p>
              </div>
              {tab.bullets?.length ? (
                <ul class="list-disc space-y-1 pl-5 text-muted dark:text-slate-300">
                  {tab.bullets.map((bullet) => (
                    <li>{bullet}</li>
                  ))}
                </ul>
              ) : null}
            </div>
          </div>
        ))}
      </div>
    </div>
  )}
</WidgetWrapper>

<script is:inline>
  const containers = document.querySelectorAll('[data-tabs-id]');

  containers.forEach((container) => {
    const buttons = container.querySelectorAll('[data-tab-target]');
    const panels = container.querySelectorAll('[data-tab-panel]');

    if (buttons.length === 0 || panels.length === 0) return;

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        const target = button.getAttribute('data-tab-target');

        buttons.forEach((item) => {
          item.classList.remove('bg-primary', 'text-white', 'shadow-sm');
          item.classList.add('text-primary');
        });

        button.classList.add('bg-primary', 'text-white', 'shadow-sm');
        button.classList.remove('text-primary');

        panels.forEach((panel) => {
          if (panel.getAttribute('data-tab-panel') === target) {
            panel.classList.remove('hidden');
          } else {
            panel.classList.add('hidden');
          }
        });
      });
    });
  });
</script>
